{"name":"sleepyMUSTACHE","tagline":"A simple PHP Framework","body":"sleepyMUSTACHE\r\n===============================================================================\r\n\r\nDetailed [Documentation] (http://www.sleepymustache.com/documentation/index.html) is available.\r\n\r\nsleepyMUSTACHE is a PHP micro framework that has solutions for everyday PHP challenges. Most of the functionality is optional and tries to be as minimalist as possible.\r\n\r\nGetting Started\r\n-------------------------------------------------------------------------------\r\nSetup will be performed automatically the first time the site is accessed. After installation is complete, it is good practice to delete the */app/setup/* folder for security reasons.\r\n\r\n\r\n### Core Functionality\r\n\r\nThe core is the basic functions that are used to build modules. They cannot be removed.\r\n\r\n* **[Debugging] (http://www.sleepymustache.com/documentation/class-Sleepy.Debug.html)** -\r\n    Easily send debug information via the browser, email, or database.\r\n\r\n* **[Hooks] (http://www.sleepymustache.com/documentation/class-Sleepy.Hook.html)** -\r\n    Hooks allow you to run a function at certain spots in your code. We call these spots *hook points*. Multiple functions may be executed at any *hook point*.\r\n\r\n* **[Templating] (http://www.sleepymustache.com/documentation/class-Sleepy.Template.html)** -\r\n    Basic templating functionality lets you separate business logic from the\r\n    view. It replaces placeholders like \"{{ title }}\" with data.\r\n\r\n* **[Routing](http://www.sleepymustache.com/documentation/class-Sleepy.Router.html)** -\r\n    A very basic routing class that allows you to build database driven applications.\r\n\r\n### Understanding the Module System\r\n\r\nEnabling and disabling modules is handled by the folder structure.\r\n\r\nThere is a */app/module/** folder that contains 2 subdirectories named */app/module/enabled* and */app/module/disabled*. To enable a module move it to the */app/module/enabled* folder. Conversely, you can disable a module by moving it to the */app/module/disabled* folder.\r\n\r\n### Available Modules\r\n\r\nModules use *hook points* to inject functionality into your application and modify data.\r\n\r\n* **CSS Compress** -\r\n    Compresses the output CSS only if the application is in the \"LIVE\" environment.\r\n\r\n* **[Navigation](http://www.sleepymustache.com/documentation/namespace-Module.Navigation.html)** -\r\n    Creates a UL based on a JSON object that can be used for navigation.\r\n\r\n* **URL Class** -\r\n    Adds a class based on the current page. For example, if your application is currently on the */user/jaime/index.php* page, the class *user-jaime-index* will be added to the body. Additionally, if you are omitting *index.php* from your URLs, e.g. */user/admin*, the class would be *user-admin-index*.\r\n\r\n* **[CSV](http://www.sleepymustache.com/documentation/namespace-Module.CSV.html)** -\r\n    Create, Read, Update, Delete (CRUD) class for CSV files with very basic querying capabilities.\r\n\r\n* **[DB](http://www.sleepymustache.com/documentation/namespace-Module.DB.html)** -\r\n    Create, Read, Update, Delete (CRUD) class using PDO and mySQL.\r\n\r\n* **[DB Grid](http://www.sleepymustache.com/documentation/class-Module.DB.Grid.html)** -\r\n    Turns a SQL Select statement into a table. The table information can be transformed using *hook filter*, making this a powerful module for visualizing and organizing data.\r\n\r\n* **[File System Database](http://www.sleepymustache.com/documentation/namespace-Module.FSDB.html)** -\r\n    A basic database that uses flat files and JSON documents. Provides simple functionality when a full blown database is overkill.\r\n\r\n* **[IP 2 Country](http://www.sleepymustache.com/documentation/namespace-Module.IP2Country.html)** -\r\n    Uses the end-users IP address to detect the country of origin.\r\n\r\n* **[Mailer](http://www.sleepymustache.com/documentation/namespace-Module.Mailer.html)** -\r\n    Provides basic email functionality with RFC email validation. Combining the templating engine with the Mailer class allows for a elegant solution to HTML email templates.\r\n\r\n* **Memcache** -\r\n    Improves performance by implementing caching of pages (10 second cache expiration by default)\r\n\r\n* **[Mobile detection](http://www.sleepymustache.com/documentation/namespace-Module.MobiDetect.html)** -\r\n    Can detect mobile and tablet devices on the server-side. This is now deprecated and will be removed for the v.1.0 release.\r\n\r\n* **HTML Compress** -\r\n    Compresses the output HTML if we are in the *live* environment.\r\n\r\n* **Head Inserter - Joey Bomber** -\r\n    Allows you to insert HTML at the end of the HEAD tag.\r\n\r\n* **Robots Dev Hide - Joey Bomber** -\r\n    Instructs search engines *NOT* to index a site while it is in the Staging environment. It does not affect live/production sites.\r\n\r\n* **[Authentication](http://www.sleepymustache.com/documentation/namespace-Module.Authentication.html)** -\r\n    Basic user and roles functionality includes a sample schema, authentication, roles, and permissions.\r\n\r\n### Sample Modules\r\n\r\nThese module have little-to-no practical use, but help demonstrate how to build simple modules with *hook filters*.\r\n\r\n* **Wizard Title** -\r\n    This module prepends an ASCII wizard to the title of the page.\r\n\r\n* **Sample Navigation** -\r\n    Demonstrates how to use the navigation module to build dynamic menus.\r\n    \r\n### Constants\r\n\r\n* **ENV**\r\n\tWhat is the current environment. Values: DEV, STAGE, LIVE\r\n\r\n* **URLBASE**\r\n\tThe base URL to the sleepyMUSTACHE base directory\r\n\r\n* **DIRBASE**\r\n\tThe base directory to the sleepyMUSTACHE base directory\r\n\r\n* **DBHOST**\r\n\tThe mySQL host URL\r\n\r\n* **DBUSER**\r\n\tthe mySQL username\r\n\r\n* **DBPASS**\r\n\tthe mySQL password\r\n\r\n* **DBNAME**\r\n\tthe mySQL database name\r\n\r\n* **EMAIL_FROM**\r\n\tThe email address to use for the \"from\" field\r\n\r\n* **EMAIL_TO**\r\n\tThe email address to use for the \"to\" field\r\n\r\n* **EMAIL_CC**\r\n\tThe email address to use for the \"cc\" field\r\n\r\n* **EMAIL_BCC**\r\n\tThe email address to use for the \"bcc\" field\r\n\r\n* **GA_ACCOUNT**\r\n\tThe Google Analytics GA Account ID\r\n\r\nSample Code\r\n-------------------------------------------------------------------------------\r\n\r\n### Hooks\r\n\r\nThe *Hooks* system is made up of *hook filters* and *hook actions*. *Hook actions* are points in the code where you can assign functions to run. For example, we can put a *hook action* after a record is saved to the database, then assign a function to the *hook action* that will send an email after the DB update. The *modules/enabled* directory provides a convenient location to put code that utilizes the hooks system. Code inside of the *modules/enabled* directory are automatically added to the program at runtime.\r\n\r\n\tnamespace Module\\Example;\r\n\t\r\n\t// Save to the database\r\n\t$db->save();\r\n\t\r\n\t// add a hook action\r\n\t\\Sleepy\\Hook::addAction('record_saved');\r\n\t\r\n\t// In the module file, add a function to the hook action\r\n\tfunction send_email() {\r\n\t\t// send an email saying a record was updated\r\n\t}\r\n\t\r\n\t\\Sleepy\\Hook::doAction(\r\n\t\t'record_saved',\r\n\t\t'\\Module\\Example\\send_email'\r\n\t);\r\n\r\n*Hook filters* are similar to *hook actions* but pass data as parameters to the functions that get assigned to the hook. After manipulating this data you must return the edited data back to the program.\r\n\r\n\tnamespace Module\\Example;\r\n\t\r\n\t// add a hook filter\r\n\t$content = \\Sleepy\\Hook::addFilter('update_content', $_POST['content']);\r\n\t\r\n\t// Add a function to the hook filter\r\n\tfunction clean_html ($html) {\r\n\t\t$c = htmlentities(trim($html), ENT_NOQUOTES, \"UTF-8\", false);\r\n\t\treturn $c;\r\n\t}\r\n\t\r\n\t\\Sleepy\\Hook::applyFilter(\r\n\t\t'update_content',\r\n\t\t'\\Module\\Example\\clean_html'\r\n\t);\r\n\r\n\r\n### Templating\r\n\r\nTemplates reside inside the */app/templates/* folder and should end in a .tpl extension. The templating system works by using placeholders that later get replaced with text. The placeholders must have the following syntax:\r\n\r\n\t{{ placeholder }}\r\n\r\nTo use a template you instantiate the template class passing in the template name. You then bind data to the placeholders and call the *Template::show()* method.\r\n\r\n\trequire_once('include/sleepy.php');\r\n\t$page = new \\Sleepy\\Template('default');\r\n\t$page->bind('title', 'sleepyMUSTACHE');\r\n\t$page->bind('header', 'Hello world!');\r\n\t$page->show();\r\n\r\nHere is the sample template file (templates/default.tpl):\r\n\r\n\t<html>\r\n\t\t<head>\r\n\t\t\t<title>{{ title }}</title>\r\n\t\t</head>\r\n\t\t<body>\r\n\t\t\t<h1>{{ header }}</h1>\r\n\t\t\t<p>This page has been viewed {{ hits }} times.</p>\r\n\t\t</body>\r\n\t</html>\r\n\r\nWe added a *{{ hits }}* placeholder in the template above. For this example, we want to replace the placeholder with the number of times this page was viewed. We can add that functionality using *Hooks*.\r\n\r\n\t// filename: /modules/enabled/hit-counter/hits.php\r\n\tnamespace Hits;\r\n\t\r\n\t/**\r\n\t * Adds the number of hits to the page.\r\n\t * @return string The total amount of hits\r\n\t */\r\n\tfunction get() {\r\n\t\t$hits = new FakeClass();\r\n\t\treturn $hits->getTotal();\r\n\t}\r\n\r\n\t// Next we attach the function to the hook point\r\n\t\\Sleepy\\Hook::applyFilter(\r\n\t\t'render_placeholder_hits',\r\n\t\t'\\Hits\\get'\r\n\t);\r\n\r\nThe first parameter of *\\Sleepy\\Hook::applyFilter()*, the *hook filter*, ends in 'hits' which correlates to the name of the placeholder. This *hook filter* is defined in *class.template.php*. The second parameter is the name of the function to run when we render the placeholder.\r\n\r\nThe templating engine allows you to iterate through multidimensional array data using #each placeholders.\r\n\r\n\t// Bind the data like this\r\n\t$page->bind('fruits', array(\r\n\t\tarray(\r\n\t\t\t\"name\" => \"apple\",\r\n\t\t\t\"color\" => \"red\"\r\n\t\t), array(\r\n\t\t\t\"name\" => \"banana\",\r\n\t\t\t\"color\" => \"yellow\"\r\n\t\t)\r\n\t));\r\n\t\r\n\t// in the .tpl file\r\n\t{{ #each f in fruits }}\r\n\t\t<p>I like {{ f.color }}, because my {{ f.name }} is {{ f.color }}.</p>\r\n\t{{ /each }}\r\n\r\n### Databases\r\n\r\nThe database connection settings are defined in the */app/include/global.php* file. After the *LIVE_URL* is set in the file the framework will detect which DB to use based on the current URL.\r\n\r\nTo get a database instance, use:\r\n\r\n\t$db = \\Module\\DB\\DB::getInstance();\r\n\r\nThe DB class is static and will automatically handle suppressing multiple\r\ndatabase connections.\r\n\r\n### Sending emails\r\n\r\nThe Mailer class simplifies sending emails by generating headers for you and using an easy to use object to clearly define your email. The Mailer can send emails using an HTML template or text.\r\n\r\n\t$m = new \\Module\\Mailer\\Message();\r\n\t$m->addTo(\"test@test.com\");\r\n\t$m->addFrom(\"from.me@test.com\");\r\n\t$m->addSubject(\"This is a test, don't panic.\");\r\n\t$m->fetchHTML(\"http://test.com/template.php\");\r\n\t\r\n\t// OR\r\n\t\r\n\t$m->msgText(\"This is my message.\")\r\n\t$m->send();\r\n\r\n### CSV\r\n\r\nThe CSV class ensures that all records are properly escaped and allows you to easily manipulate data inside of a CSV file.\r\n\r\n\t$c = new \\Module\\CSV\\Document();\r\n\t$data = array(\r\n\t\t'George',\r\n\t\t'Washington'\r\n\t);\r\n\t$c->add($data);\r\n\t\r\n\t// Saves to the file system\r\n\t$c->save('presidents.csv');\r\n\t\r\n\t// OR\r\n\t\r\n\t// Sends the file to the browser, does not save to the file system\r\n\t$c->show();\r\n\r\n\r\n### Debugging\r\n\r\nThe *Debug* static class allows you to debug on-screen, via email, or by logging to a database.\r\n\r\n\t$db = \\Module\\DB\\DB::getInstance();\r\n\t\\Sleepy\\Debug::out($db);\r\n\r\n### File System Database (class.fsdb.php)\r\n\r\nSometimes using a database is overkill.  A simple solution is to use the *FSDB*. It is very simple and does not allow complex queries, however it is fast, easy to use, and requires no setup, except checking that proper permissions are set.\r\n\r\n\t$fruit = new stdClass();\r\n\t\r\n\t$fruit->name = \"Apple\";\r\n\t$fruit->color = \"Red\";\r\n\t$fruit->texture = \"Crispy\";\r\n\t$fruit->price = 0.50;\r\n\t\r\n\t$db = new \\Module\\FSDB\\Connection();\r\n\t\r\n\t$db->insert('fruit', $fruit);\r\n\t$data = $db->select('fruit', 'name', 'Apple');\r\n\r\n### Country detection\r\n\r\n*Country detection* uses the *FSDB* to do a quick lookup of the current country.\r\n\r\n\t$i = new \\Module\\IP2Country\\Converter();\r\n\t$countryCode = $i->getCountryCode($_SERVER['REMOTE_ADDR']);\r\n\t\r\n\tif ($countryCode != false) {\r\n\t\techo $countryCode;\r\n\t} else {\r\n\t\techo $_SERVER['REMOTE_ADDR'] . \"(\" . ip2long($_SERVER['REMOTE_ADDR']) . \") Not found in \" . $i->getTable($_SERVER['REMOTE_ADDR']) . \".\";\r\n\t}\r\n\r\n### Mobile detection\r\n\r\nMobile detection is done by comparing the UA (user-agent) to a list of currently available mobile and tablet UA. This module is **deprecated** and will be phased out in v1.0.\r\n\r\n\t$md = new \\Mobile\\MobiDetect\\Detector();\r\n\t\r\n\tif ($md->isMobile()) {\r\n\t\t// Do something for mobile only\r\n\t}\r\n\r\n### Navigation\r\n\r\nThe navigation is generated from JSON. It renders the JSON into a unordered list with some classes added for the current active page.\r\n\r\n\t// Add a placeholder in your template\r\n\t{{ TopNav }}\r\n\t\r\n\t// Create a php file in */modules/enabled/*\r\n\tnamespace Module\\Example;\r\n\t\r\n\trequire_once('include/class.navigation.php');\r\n\t\r\n\t// create a function to add to the *hook filter*\r\n\tfunction showNav() {\r\n\t\t// Page data is passed via JSON\r\n\t\t$topNavData = '{\r\n\t\t\t\"pages\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"title\": \"Nav 1\",\r\n\t\t\t\t\t\"link\": \"/nav1/\"\r\n\t\t\t\t}, {\r\n\t\t\t\t\t\"title\": \"Nav 2\",\r\n\t\t\t\t\t\"link\": \"/nav2/\",\r\n\t\t\t\t\t\"pages\": [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\"title\": \"Subnav 1\",\r\n\t\t\t\t\t\t\t\"link\": \"/downloads/fpo.pdf\",\r\n\t\t\t\t\t\t\t\"target\": \"_blank\"\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}';\r\n\t\r\n\t\t$topNav = new \\Module\\Navigation\\Builder($topNavData);\r\n\t\t$topNav->setCurrent($_SERVER['SCRIPT_NAME']);\r\n\t\r\n\t\treturn $topNav->show();\r\n\t}\r\n\t\r\n\t\\Sleepy\\Hook::applyFilter(\r\n\t\t'render_placeholder_TopNav',\r\n\t\t'\\Module\\Example\\showNav'\r\n\t);","google":"UA-55477508-1","note":"Don't delete this file! It's used internally to help with page regeneration."}